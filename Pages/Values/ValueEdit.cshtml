@page
@model EavWebApp.Pages.Values.ValueEditModel
@{
    ViewData["Title"] = "Редактировать запись";
}

<h2 class="mt-3 mb-4">Редактировать запись</h2>

@if (Model.TableInfo != null && Model.Fields.Any())
{
    <div class="card p-4 shadow-sm">
        <h5>Таблица: <b>@Model.TableInfo.Name</b></h5>

        <form method="post">
            @for (int i = 0; i < Model.Fields.Count; i++)
            {
                <div class="mb-3">
                    <input type="hidden" asp-for="Values[i].Id" />
                    <input type="hidden" asp-for="Values[i].FieldId" />
                    <input type="hidden" asp-for="Values[i].TableId" />
                    <input type="hidden" asp-for="Values[i].ObjectId" />

                    <label class="form-label fw-bold">@Model.Fields[i].Name</label>

                    @if (Model.Fields[i].FieldType == "key" && Model.KeyOptions.ContainsKey(Model.Fields[i].Id))
                    {
                        <select asp-for="Values[i].Val" class="form-control">
                            <option value="">Выберите...</option>
                            @foreach (var option in Model.KeyOptions[Model.Fields[i].Id])
                            {
                                <option value="@option.Key">@option.Value</option>
                            }
                        </select>
                    }
                    else
                    {
                        <input asp-for="Values[i].Val" class="form-control" />
                    }

                    <span asp-validation-for="Values[i].Val" class="text-danger"></span>
                </div>
            }

            <div class="mt-4">
                <button type="submit" class="btn btn-success">Сохранить все изменения</button>
                <a asp-page="/Tables/TableEdit" asp-route-id="@Model.TableInfo.Id" class="btn btn-secondary">Отмена</a>
            </div>
        </form>
    </div>
}
else
{
    <div class="alert alert-warning">Данные не найдены.</div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}